<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- TopoJSON -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"
        integrity="sha256-tHoAPGoNdhIR28YHl9DWLzeRfdwigkH7OCBXMrHXhoM=" crossorigin="anonymous"></script>

    <!-- Annotation Library -->
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

    <title>State of the Vaccine</title>
</head>

<body>

	<!--
        Title Section:
        - title
        - description
        - background image
    -->
	<section id="title-section">
		<div id="covid-background-image">
			<div id="overlay">
				<h1 id="title" class="animate__animated animate__fadeInUp animate__delay-1s">State of the Vaccine</h1>
				<p id="title-description" class="animate__animated animate__fadeInUp animate__delay-2s">An in-depth
					analysis on the
					effectiveness
					of COVID
					Vaccines in the U.S.</p>

			</div>
		</div>
	</section>

	<section id="covid-before-map-section">
		<p class="animate__animated animate__fadeIn">
			December 12th, 2020, a day before the vaccine was to begin being distributed, the United States witnessed a
			serge of cases across the country. The virus was nearing its peak and the country was in full lockdown.
		</p>

		<!-- Radio Buttons -->
		<input type="range" name="slider1" id="slider1" min="0" max="25" value="0">

		<!-- <svg1 id="canvas"></svg1> -->
		<div id="slide1"></div>
		</div>
	</section>

	<section id="covid-after-map-section">
		<p class="animate__animated animate__fadeIn">
			he country. The virus was nearing its peak and the country was in full lockdown.
		</p>

		<!-- Radio Buttons -->
		<button onclick="drawMap('#slide2', 'US');">United States</button>
		<button onclick="drawMap('#slide2', 'Brit');">Britain</button>
		<button onclick="drawMap('#slide2', 'Can');">Canada</button>
		<button onclick="drawMap('#slide2', 'Aus');">Australia</button>
		<input type="range" name="slider2" id="slider2" min="0" max="25" value="0">

		<!-- <svg1 id="canvas"></svg1> -->
		<div id="slide2"></div>
		</div>
	</section>
</body>

</html>

<script>
	var margin = { top: 20, right: 50, bottom: 30, left: 50 },
		width = 700 - margin.left - margin.right,
		height = 500 - margin.top - margin.bottom;

	var svg1 = d3.select("#slide1")
		.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
		.append("g")
		.attr("transform",
			"translate(" + margin.left + "," + margin.top + ")");

	d3.csv("data/US_Blood.csv", function (bloodData) {
		d3.csv("data/US_Crime.csv", function (crimeData) {
			// Convert the data to the appropriate format for US_Blood.csv
			const parsedBloodData = bloodData.map((d) => ({
				year: parseInt(d.year),
				value: parseFloat(d.BLL),
			}));
			
			
			const parsedCrimeData = crimeData.map((d) => ({
				year: parseInt(d.year),
				value: parseFloat(d.crime),
			}));

			var xScale = d3.scaleLinear().domain([1936, 2014]).range([0, width]);
			
			var yScaleCrime = d3.scaleLinear().domain([0, d3.max(parsedCrimeData, (d) => d.value)]).range([height, 0]);
			var yScaleBlood = d3.scaleLinear().domain([0, d3.max(parsedBloodData, (d) => d.value)]).range([height, 0]);

			// Define the line generator
			var lineBlood = d3.line()
				.x((d) => xScale(d.year))
				.y((d) => yScaleBlood(d.value));
			
			var lineCrime = d3.line()
			.defined((d) => d.year >= 1960 && d.year <= 2014) // Only include data within the range
			.x((d) => xScale(d.year))
			.y((d) => yScaleCrime(d.value));

			// Create the path for the line chart for US_Blood.csv
			var Line = svg1
				.append("path")
				.datum(parsedBloodData)
				.attr("fill", "none")
				.attr("stroke", "red")
				.attr("stroke-width", 2)
				.attr("d", lineBlood);

			svg1
			.append("path")
			.datum(parsedCrimeData)
			.attr("fill", "none")
			.attr("stroke", "steelblue")
			.attr("stroke-width", 2)
			.attr("d", lineCrime);

			// Add x and y axes for blood data
			// svg1.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(xScale));
			svg1.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(xScale).tickFormat(d3.format("d")));
			svg1.append("g").call(d3.axisLeft(yScaleBlood));
			svg1.append("g").attr("transform", `translate(${width}, 0)`).call(d3.axisRight(yScaleCrime));



			
			function updateChart(sliderValue) {
				var lineBlood = d3.line()
					.x((d) => xScale(d.year + parseInt(sliderValue)))
					.y((d) => yScaleBlood(d.value));
				Line
					.datum(parsedBloodData)
					.transition()
					.duration(20)
					.attr("d", lineBlood);
			}
			//listen for slider update
			d3.select("#slider1").on("input", function (d) {
				selectedValue = this.value
				updateChart(selectedValue)
			});
		});
	});





let drawAll = (locationId, country) => {
    Promise.all([
        d3.csv("data/US_Blood.csv"),
        d3.csv("data/US_Crime.csv"),
        d3.csv("data/Brit_Blood.csv"),
        d3.csv("data/Brit_Crime.csv"),
        d3.csv("data/Canada_Blood.csv"),
        d3.csv("data/Canada_Crime.csv"),
        d3.csv("data/Aus_Blood.csv"),
        d3.csv("data/Aus_Crime.csv"),
    ]).then(([usBloodData, usCrimeData, britBloodData, britCrimeData, canadaBloodData, canadaCrimeData, ausBloodData, ausCrimeData]) => {
        // Draw the 4 graphs using drawLineChart function
        if(country === "US") {
          drawLineChart(usBloodData, usCrimeData, locationId, true); // Draw US_Blood.csv and US_Crime.csv
        } else if (country === "brit") {
          drawLineChart(britBloodData, britCrimeData, locationId, false); // Draw Brit_Blood.csv and Brit_Crime.csv
        } else if (country === "canada") {
          drawLineChart(canadaBloodData, canadaCrimeData, locationId, false); // Draw Canada_Blood.csv and Canada_Crime.csv
        } else if (country === "aus") {
          drawLineChart(ausBloodData, ausCrimeData, locationId, false); // Draw US_Blood.csv and US_Crime.csv with add20 true
        }

    });
};


let drawLineChart = (bloodData, crimeData, locationId, add20) => {
    d3.select(locationId).select("svg").remove();
    // Set up the dimensions for the chart
    const margin = { top: 20, right: 50, bottom: 30, left: 50 };
    const width = 700 - margin.left - margin.right;
    const height = 500 - margin.top - margin.bottom;
  
    // Create the SVG element
    // const svg = d3.select(locationId)
    // .append("svg")
    // .attr("viewBox", viewWindow)
    // .attr("preserveAspectRatio", "xMinYMin meet")
    // .attr("height", "100%")
    // .attr("width", "100%");
  
    const svg = d3
    .select(locationId)
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);
    
    // Convert the data to the appropriate format for US_Blood.csv
    const parsedBloodData = bloodData.map((d) => ({
      year: parseInt(d.year),
      value: parseFloat(d.BLL),
    }));
  
    // Convert the data to the appropriate format for US_Crime.csv
    const parsedCrimeData = crimeData.map((d) => ({
      year: parseInt(d.year),
      value: parseFloat(d.crime),
    }));
  
    // Define the scales for x and y axes
    const xScale = d3.scaleLinear().domain([1936, 2014]).range([0, width]);
  
    const yScaleBlood = d3.scaleLinear().domain([0, d3.max(parsedBloodData, (d) => d.value)]).range([height, 0]);
  
    const yScaleCrime = d3.scaleLinear().domain([0, d3.max(parsedCrimeData, (d) => d.value)]).range([height, 0]);
    console.log(yScaleCrime)
    // Define the line generators
    const lineBlood = d3
      .line()
      .x((d) => xScale(add20 ? d.year + 23 : d.year)) // Add 20 years to each data point if add20 is true
      .y((d) => yScaleBlood(d.value));

    const lineCrime = d3
      .line()
      .defined((d) => d.year >= 1960 && d.year <= 2014) // Only include data within the range
      .x((d) => xScale(d.year))
      .y((d) => yScaleCrime(d.value));
  
    // Create the path for the line chart for US_Blood.csv
    svg
      .append("path")
      .datum(parsedBloodData)
      .attr("fill", "none")
      .attr("stroke", "red")
      .attr("stroke-width", 2)
      .attr("d", lineBlood);
  
    // Create the path for the line chart for US_Crime.csv
    svg
      .append("path")
      .datum(parsedCrimeData)
      .attr("fill", "none")
      .attr("stroke", "steelblue")
      .attr("stroke-width", 2)
      .attr("d", lineCrime);
  
    // Add x and y axes
    svg.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(xScale));
  
    svg.append("g").call(d3.axisLeft(yScaleBlood));
  
    // Add a second y-axis for US_Crime.csv data
    svg.append("g").attr("transform", `translate(${width}, 0)`).call(d3.axisRight(yScaleCrime));
  };
</script>
